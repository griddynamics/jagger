<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Jagger: Http scenario load test</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Jagger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<link href="tab-panel.css" rel="stylesheet" type="text/css">
  <script language="type="text/javascript"JavaScript" type="text/javascript" src="tab-panel.js">
  </script></head>
</head>
<body onload="bodyOnLoad()" onresize="raisePanel(currentMenuIndex)">
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('HttpUserScenarioTest.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Http scenario load test </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We consider that at this point, you have already <a class="el" href="WritingTest.html">learned how to create simple load tests</a> <br/>
</p>
<ul>
<li><a class="el" href="HttpUserScenarioTest.html#section_http_scenario_overview">Overview</a> </li>
<li><a class="el" href="HttpUserScenarioTest.html#section_http_scenario_components">Http user scenario components</a> </li>
<li><a class="el" href="HttpUserScenarioTest.html#section_http_scenario_execution">Http user scenario load configuration</a> </li>
<li><a class="el" href="HttpUserScenarioTest.html#section_http_scenario_creation">Creating scenario</a></li>
</ul>
<h1><a class="anchor" id="section_http_scenario_overview"></a>
Overview</h1>
<dl class="section user"><dt>Terms</dt><dd><ul>
<li><b> Http user scenario </b> - sequence of the related http requests provided by virtual user </li>
<li><b> Scenario step </b> - single http requests in the scenario</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Main features</dt><dd><ul>
<li>Ability to provide Http user scenario tests with different <a class="el" href="group__Main__Load__profiles__group.html">load profiles</a> </li>
<li>Global context per scenario execution to set endpoint, headers, execute all steps within single authentication session </li>
<li>Ability to change global context on the run </li>
<li>Ability to change next step in the scenario based on the results of the previous step </li>
<li>Step execution validation. Stop scenario execution on fail </li>
<li>Configurable metrics collection per step / scenario: response time, success rate, number of iterations </li>
<li>Support of the Basic authentication </li>
<li>Ability to execute every scenario <a class="el" href="group__Main__Distributors__group.html">exclusively</a>. Only one virtual user is running scenario at a time </li>
<li>Ability to execute every scenario <a class="el" href="group__Main__Distributors__group.html">only single time</a></li>
</ul>
</dd></dl>
<h1><a class="anchor" id="section_http_scenario_components"></a>
Http user scenario components</h1>
<p><a class="el" href="group__Main__Http__User__Scenario__group.html">Http user scenario configuration components</a></p>
<h1><a class="anchor" id="section_http_scenario_execution"></a>
Http user scenario load configuration</h1>
<dl class="section user"><dt>Execute http user load scenario</dt><dd> <div class="fragment"><div class="line"><span class="comment">//begin: following section is used for docu generation - User scenario execution</span></div>
<div class="line"></div>
<div class="line">@Configuration</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>UserScenarioJLoadScenarioProvider {</div>
<div class="line"></div>
<div class="line">    @Bean</div>
<div class="line">    <span class="keyword">public</span> JLoadScenario exampleSimpleJaggerLoadScenarioUS() {</div>
<div class="line"></div>
<div class="line">        <span class="comment">//begin: following section is used for docu generation - Load balancer setup</span></div>
<div class="line"></div>
<div class="line">        JTestDefinition jTestDefinition =</div>
<div class="line">                JTestDefinition.builder(Id.of(<span class="stringliteral">&quot;td_user_scenario_example&quot;</span>), <span class="keyword">new</span> UserScenarioEndpointsProvider())</div>
<div class="line">                        .withInvoker(<span class="keyword">new</span> JHttpUserScenarioInvokerProvider())</div>
<div class="line">                        <span class="comment">// Exclusive access - single scenario is executed only by one virtual user at a time. No parallel execution</span></div>
<div class="line">                        <span class="comment">// Random seed - different virtual users execute scenarios in different order</span></div>
<div class="line">                        .withLoadBalancer(JLoadBalancer.builder(ROUND_ROBIN)</div>
<div class="line">                                .withExclusiveAccess()</div>
<div class="line">                                .withRandomSeed(1234)</div>
<div class="line">                                .build())</div>
<div class="line">                        .addListener(JHttpUserScenarioInvocationListener.builder()</div>
<div class="line">                                .withLatencyAvgStddevAggregators()</div>
<div class="line">                                .withLatencyMinMaxAggregators()</div>
<div class="line">                                .withLatencyPercentileAggregators(50D, 95D, 99D)</div>
<div class="line">                                .build())</div>
<div class="line">                        .build();</div>
<div class="line"></div>
<div class="line">        <span class="comment">//end: following section is used for docu generation - Load balancer setup</span></div>
<div class="line"></div>
<div class="line">        JLoadProfile jLoadProfileInvocations =</div>
<div class="line">                JLoadProfileInvocation.builder(InvocationCount.of(100), ThreadCount.of(2))</div>
<div class="line">                        .build();</div>
<div class="line"></div>
<div class="line">        JTerminationCriteria jTerminationCriteria =</div>
<div class="line">                JTerminationCriteriaIterations.of(IterationsNumber.of(500), MaxDurationInSeconds.of(50));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// We are setting acceptance criteria for particular metric of the selected step in the scenario</span></div>
<div class="line">        JLimit avgLatencyLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_1_ID, StandardMetricsNamesUtil.LATENCY_AVG_AGG_ID, RefValue.of(1.2))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.25), UpErrThresh.of(2.0))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit stdDevLatencyLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_1_ID, StandardMetricsNamesUtil.LATENCY_STD_DEV_AGG_ID, RefValue.of(0.5))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.5), UpErrThresh.of(1.5))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit maxLatencyLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_2_ID, StandardMetricsNamesUtil.LATENCY_MAX_AGG_ID, RefValue.of(2.0))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.5), UpErrThresh.of(1.5))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit minDevLatencyLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_2_ID, StandardMetricsNamesUtil.LATENCY_MIN_AGG_ID, RefValue.of(0.2))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.5), UpErrThresh.of(1.5))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit percentile99LatencyLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_2_ID, JMetricName.PERF_LATENCY_PERCENTILE(99D), RefValue.of(2.0))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.5), UpErrThresh.of(1.5))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit successRateLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_1_ID, JMetricName.PERF_SUCCESS_RATE_OK, RefValue.of(1.0))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.99), UpErrThresh.of(1.01))</div>
<div class="line">                        .build();</div>
<div class="line">        JLimit errorsLimit =</div>
<div class="line">                JLimitVsRefValue.builder(SCENARIO_ID, STEP_2_ID, JMetricName.PERF_SUCCESS_RATE_FAILS, RefValue.of(0.0))</div>
<div class="line">                        .withOnlyErrors(LowErrThresh.of(0.99), UpErrThresh.of(1.01))</div>
<div class="line">                        .build();</div>
<div class="line"></div>
<div class="line">        JLoadTest jLoadTest =</div>
<div class="line">                JLoadTest.builder(Id.of(<span class="stringliteral">&quot;lt_user_scenario_example&quot;</span>), jTestDefinition, jLoadProfileInvocations, jTerminationCriteria)</div>
<div class="line">                        .withLimits(avgLatencyLimit, stdDevLatencyLimit, minDevLatencyLimit, maxLatencyLimit, percentile99LatencyLimit, successRateLimit, errorsLimit)</div>
<div class="line">                        .build();</div>
<div class="line"></div>
<div class="line">        JParallelTestsGroup jParallelTestsGroup =</div>
<div class="line">                JParallelTestsGroup.builder(Id.of(<span class="stringliteral">&quot;ptg_user_scenario_example&quot;</span>), jLoadTest)</div>
<div class="line">                        .build();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// To launch your load scenario, set &#39;jagger.load.scenario.id.to.execute&#39; property&#39;s value equal to the load scenario id</span></div>
<div class="line">        <span class="comment">// You can do it via system properties or in the &#39;environment.properties&#39; file</span></div>
<div class="line">        <span class="keywordflow">return</span> JLoadScenario.builder(Id.of(<span class="stringliteral">&quot;ls_user_scenario_example&quot;</span>), jParallelTestsGroup)</div>
<div class="line">                .build();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//end: following section is used for docu generation - User scenario execution</span></div>
</div><!-- fragment --></dd></dl>
<p>Provider example code is available in <a class="el" href="Installation.html#section_installation_local">the archetype</a></p>
<p>User scenario load has the same configuration like simple examples from the previous chapter: <a class="el" href="WritingTest.html#section_writing_test_example">Load scenario configuration</a> <br/>
 Important points in the example above: </p>
<ul>
<li>Provider of the endpoints for <a class="el" href="WritingTest.html#section_writing_test_definition">the test definition</a> returns list of <a class="el" href="classcom_1_1griddynamics_1_1jagger_1_1invoker_1_1scenario_1_1JHttpUserScenario.html">User scenarios</a>. User scenarios contains full description of the test: endpoints, queries, headers, etc. In such case we don't need query provider </li>
<li>We are using <a class="el" href="classcom_1_1griddynamics_1_1jagger_1_1invoker_1_1scenario_1_1JHttpUserScenarioInvoker.html">dedicated invoker</a> to run user scenario test </li>
<li>We are using <a class="el" href="group__Main__Distributors__group.html">load balancer with exclusive setup</a>. That means at any time, every scenario will be executed only by single virtual user. Other virtual users will execute different scenarios. </li>
<li>We are setting additional configurable <a class="el" href="classcom_1_1griddynamics_1_1jagger_1_1invoker_1_1scenario_1_1JHttpUserScenarioInvocationListener.html">user scenario invocation listener</a> to collect metrics per step and scenario. Without this listener metrics will be not collected </li>
<li>There is an ability to set acceptance criteria per different metric in the steps of the scenario <br/>
</li>
</ul>
<h1><a class="anchor" id="section_http_scenario_creation"></a>
Creating scenario</h1>
<dl class="section user"><dt>Example of the user load scenario creation</dt><dd> <div class="fragment"><div class="line"><span class="comment">// begin: following section is used for docu generation - User scenario provider</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>UserScenarioEndpointsProvider <span class="keyword">implements</span> Iterable {</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SCENARIO_ID = <span class="stringliteral">&quot;my-user-scenario&quot;</span>;</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String STEP_1_ID = <span class="stringliteral">&quot;step321&quot;</span>;</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String STEP_2_ID = <span class="stringliteral">&quot;step2&quot;</span>;</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String STEP_3_ID = <span class="stringliteral">&quot;step3&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(UserScenarioEndpointsProvider.class);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span> List&lt;JHttpUserScenario&gt; userScenarios = <span class="keyword">new</span> ArrayList&lt;&gt;();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">public</span> UserScenarioEndpointsProvider() {</div>
<div class="line"></div>
<div class="line">        <span class="comment">// First scenario example</span></div>
<div class="line">        JHttpUserScenario userScenario = <span class="keyword">new</span> JHttpUserScenario(SCENARIO_ID, <span class="stringliteral">&quot;My User Scenario&quot;</span>);</div>
<div class="line"></div>
<div class="line">        userScenario</div>
<div class="line">                .withScenarioGlobalContext(<span class="keyword">new</span> JHttpScenarioGlobalContext()</div>
<div class="line">                        .withGlobalEndpoint(<span class="keyword">new</span> JHttpEndpoint(<span class="stringliteral">&quot;https://httpbin.org/&quot;</span>)))</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(STEP_1_ID)</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Step #321&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .build())</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(STEP_2_ID)</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Step #2&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .withQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/get&quot;</span>))</div>
<div class="line">                        <span class="comment">// global context can be changed before or after step execution.</span></div>
<div class="line">                        <span class="comment">// E.g. we can add headers to all following requests in this scenario</span></div>
<div class="line">                        .withPreProcessGlobalContextFunction((prevStep, context) -&gt; {</div>
<div class="line">                            context.withGlobalHeaders(prevStep.getResponse().getHeaders());</div>
<div class="line">                        })</div>
<div class="line">                        <span class="comment">// you can decide if step was successful or not</span></div>
<div class="line">                        .withPostProcessFunction(response -&gt; {</div>
<div class="line">                            <span class="keywordflow">if</span> (response.getStatus().is2xxSuccessful()) {</div>
<div class="line">                                log.info(<span class="stringliteral">&quot;Step 2 is successful!&quot;</span>);</div>
<div class="line">                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                        })</div>
<div class="line">                        .build())</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(STEP_3_ID)</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Step #3&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .withQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/response-headers?key=val&quot;</span>))</div>
<div class="line">                        <span class="comment">// You can modify this step, based of the results of the previous one</span></div>
<div class="line">                        <span class="comment">// Here we are setting endpoint and query values</span></div>
<div class="line">                        .withPreProcessFunction((prevStep, currentStep) -&gt; {</div>
<div class="line">                            currentStep.setEndpoint(<span class="keyword">new</span> JHttpEndpoint(<span class="stringliteral">&quot;http://www.scala-lang.org&quot;</span>));</div>
<div class="line">                            currentStep.setQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/&quot;</span>));</div>
<div class="line">                        })</div>
<div class="line">                        .build());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Scenario example with basic authentication</span></div>
<div class="line">        JHttpUserScenario userScenarioBasicAuthAuto = <span class="keyword">new</span> JHttpUserScenario(<span class="stringliteral">&quot;my-user-scenario-basic-auth&quot;</span>,</div>
<div class="line">                <span class="stringliteral">&quot;Basic Auth User Scenario&quot;</span>);</div>
<div class="line"></div>
<div class="line">        userScenarioBasicAuthAuto</div>
<div class="line">                <span class="comment">// All requests in this scenario will use following basic authentication</span></div>
<div class="line">                .withScenarioGlobalContext(<span class="keyword">new</span> JHttpScenarioGlobalContext()</div>
<div class="line">                        .withGlobalEndpoint(<span class="keyword">new</span> JHttpEndpoint(<span class="stringliteral">&quot;https://httpbin.org/&quot;</span>))</div>
<div class="line">                        .withBasicAuth(<span class="stringliteral">&quot;userName&quot;</span>, <span class="stringliteral">&quot;userPassword&quot;</span>)</div>
<div class="line">                )</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(<span class="stringliteral">&quot;basic_auto_1&quot;</span>)</div>
<div class="line">                        .withQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/basic-auth/userName/userPassword&quot;</span>))</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Auth pass&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .build())</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(<span class="stringliteral">&quot;basic_auto_2&quot;</span>)</div>
<div class="line">                        .withQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/basic-auth/userName/userPassword&quot;</span>))</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Auth pass (validation)&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .withPostProcessFunction(response -&gt; {</div>
<div class="line">                            <span class="keywordflow">if</span> (response.getStatus().value() != 200) {</div>
<div class="line">                                log.error(<span class="stringliteral">&quot;Unexpected status returned. Expected: 200. Returned: {}&quot;</span>, response.getStatus().value());</div>
<div class="line">                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                        })</div>
<div class="line">                        .build())</div>
<div class="line">                .addStep(JHttpUserScenarioStep.builder(<span class="stringliteral">&quot;basic_auto_3&quot;</span>)</div>
<div class="line">                        .withQuery(<span class="keyword">new</span> JHttpQuery().<span class="keyword">get</span>().path(<span class="stringliteral">&quot;/basic-auth/userName/userPassword&quot;</span>))</div>
<div class="line">                        .withDisplayName(<span class="stringliteral">&quot;Auth fail (validation)&quot;</span>)</div>
<div class="line">                        .withWaitAfterExecutionInSeconds(3)</div>
<div class="line">                        .withPreProcessFunction((prevStep, currentStep) -&gt; {</div>
<div class="line">                            <span class="comment">// Reset all headers =&gt; auth will fail</span></div>
<div class="line">                            currentStep.getQuery().headers(null);</div>
<div class="line">                        })</div>
<div class="line">                        .withPostProcessFunction(response -&gt; {</div>
<div class="line">                            <span class="keywordflow">if</span> (response.getStatus().value() != 401) {</div>
<div class="line">                                log.error(<span class="stringliteral">&quot;Unexpected status returned. Expected: 401. Returned: {}&quot;</span>, response.getStatus().value());</div>
<div class="line">                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                            }</div>
<div class="line">                            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">                        })</div>
<div class="line">                        .build());</div>
<div class="line"></div>
<div class="line">        userScenarios.add(userScenario);</div>
<div class="line">        userScenarios.add(userScenarioBasicAuthAuto);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    @Override</div>
<div class="line">    <span class="keyword">public</span> Iterator&lt;JHttpUserScenario&gt; iterator() {</div>
<div class="line">        <span class="keywordflow">return</span> userScenarios.iterator();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">// end: following section is used for docu generation - User scenario provider</span></div>
</div><!-- fragment --></dd></dl>
<p>Provider example code is available in <a class="el" href="Installation.html#section_installation_local">the archetype</a></p>
<p>Important points in the example above: </p>
<ul>
<li>There is an option to setup <a class="el" href="classcom_1_1griddynamics_1_1jagger_1_1invoker_1_1scenario_1_1JHttpScenarioGlobalContext.html">global context</a> per scenario. This context will be available for every step in the scenario, can be modified on the run. Context will be reset to default state at the beginning of the scenario execution </li>
<li>It is recommended to set delays after every step in the scenario. That will simulate real user behaviour </li>
<li>There is an option to validate response of the step and stop scenario execution if validation fails </li>
<li>There is an option to change next step in the scenario based on the results of the previous one </li>
<li>You can see an example of the Basic Authentication setup. User name and password from the global context will be used to generate basic authentication header for every step in the scenario </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Mar 2 2017 21:43:20 for Jagger by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
